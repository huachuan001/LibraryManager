# CircleCI éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨CircleCIä¸Šé…ç½®Library Manageré¡¹ç›®çš„CI/CDæµç¨‹ï¼Œå®ç°ï¼š
- æäº¤PRåè‡ªåŠ¨è§¦å‘æ„å»º
- æ‰§è¡ŒTestNGæµ‹è¯•
- æ„å»ºDockeré•œåƒ
- éƒ¨ç½²æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡å·¥ä½œ

#### 1.1 ç¡®ä¿é¡¹ç›®å·²æ¨é€åˆ°GitHub
```bash
git add .
git commit -m "Add CircleCI configuration"
git push origin main
```

#### 1.2 åœ¨CircleCIä¸Šè®¾ç½®é¡¹ç›®
1. è®¿é—® [CircleCI](https://circleci.com/)
2. ä½¿ç”¨GitHubè´¦å·ç™»å½•
3. åœ¨Dashboardä¸­ç‚¹å‡»"Add Projects"
4. æ‰¾åˆ°æ‚¨çš„Library Manageré¡¹ç›®
5. ç‚¹å‡»"Set Up Project"

### 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨éœ€è¦æ¨é€Dockeré•œåƒåˆ°Docker Hubï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

1. åœ¨CircleCIé¡¹ç›®è®¾ç½®ä¸­ï¼Œè¿›å…¥"Environment Variables"
2. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š
   - `DOCKER_USERNAME`: æ‚¨çš„Docker Hubç”¨æˆ·å
   - `DOCKER_PASSWORD`: æ‚¨çš„Docker Hubå¯†ç æˆ–è®¿é—®ä»¤ç‰Œ

### 3. å·¥ä½œæµç¨‹è¯´æ˜

#### 3.1 è§¦å‘æ¡ä»¶
- **PRåˆ›å»º/æ›´æ–°**: è‡ªåŠ¨è§¦å‘æ„å»ºå’Œæµ‹è¯•
- **æ¨é€åˆ°mainåˆ†æ”¯**: æ‰§è¡Œå®Œæ•´çš„CI/CDæµç¨‹
- **æ¨é€åˆ°feature/*æˆ–bugfix/*åˆ†æ”¯**: æ‰§è¡Œæ„å»ºå’Œæµ‹è¯•

#### 3.2 ä½œä¸šæµç¨‹
```
1. build-and-test
   â”œâ”€â”€ æ£€å‡ºä»£ç 
   â”œâ”€â”€ æ¢å¤Gradleç¼“å­˜
   â”œâ”€â”€ æ„å»ºé¡¹ç›®
   â”œâ”€â”€ è¿è¡ŒTestNGæµ‹è¯•
   â”œâ”€â”€ ä¿å­˜æµ‹è¯•æŠ¥å‘Š
   â””â”€â”€ ä¿å­˜æ„å»ºäº§ç‰©

2. docker-build-and-test (ä¾èµ–build-and-test)
   â”œâ”€â”€ æ¢å¤æ„å»ºäº§ç‰©
   â”œâ”€â”€ è®¾ç½®Dockerç¯å¢ƒ
   â”œâ”€â”€ æ„å»ºDockeré•œåƒ
   â”œâ”€â”€ è¿è¡Œå®¹å™¨
   â”œâ”€â”€ å¥åº·æ£€æŸ¥
   â”œâ”€â”€ é›†æˆæµ‹è¯•
   â””â”€â”€ æ¸…ç†å®¹å™¨
```

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### .circleci/config.yml ç»“æ„

```yaml
version: 2.1

jobs:
  build-and-test:          # æ„å»ºå’Œæµ‹è¯•ä½œä¸š
  docker-build-and-test:   # Dockeræ„å»ºå’Œéƒ¨ç½²æµ‹è¯•ä½œä¸š

workflows:
  build-test-deploy:       # å·¥ä½œæµç¨‹å®šä¹‰
```

### å…³é”®é…ç½®è¯´æ˜

#### 1. æ‰§è¡Œå™¨é…ç½®
```yaml
docker:
  - image: openjdk:17-jdk-slim  # ä½¿ç”¨OpenJDK 17
working_directory: ~/project    # å·¥ä½œç›®å½•
```

#### 2. ç¼“å­˜é…ç½®
```yaml
# æ¢å¤Gradleç¼“å­˜
- restore_cache:
    keys:
      - gradle-{{ checksum "build.gradle" }}
      - gradle-

# ä¿å­˜Gradleç¼“å­˜
- save_cache:
    paths:
      - ~/.gradle
    key: gradle-{{ checksum "build.gradle" }}
```

#### 3. æµ‹è¯•æŠ¥å‘Š
```yaml
# ä¿å­˜TestNGæµ‹è¯•æŠ¥å‘Š
- store_test_results:
    path: build/test-results/testNG
```

#### 4. Dockeré…ç½®
```yaml
# è®¾ç½®è¿œç¨‹Dockerç¯å¢ƒ
- setup_remote_docker:
    version: 20.10.14
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### 1. æŸ¥çœ‹æ„å»ºçŠ¶æ€
- åœ¨CircleCI Dashboardä¸­æŸ¥çœ‹æ„å»ºçŠ¶æ€
- ç‚¹å‡»å…·ä½“çš„æ„å»ºæŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### 2. æµ‹è¯•æŠ¥å‘Š
- TestNGæµ‹è¯•æŠ¥å‘Šä¼šè‡ªåŠ¨ä¿å­˜åˆ°CircleCI
- åœ¨æ„å»ºè¯¦æƒ…é¡µé¢çš„"Tests"æ ‡ç­¾ä¸­æŸ¥çœ‹

### 3. å¸¸è§é—®é¢˜æ’æŸ¥

#### æ„å»ºå¤±è´¥
1. æ£€æŸ¥Javaç‰ˆæœ¬å…¼å®¹æ€§
2. ç¡®è®¤Gradle Wrapperæƒé™
3. æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

#### Dockeræ„å»ºå¤±è´¥
1. æ£€æŸ¥Dockerfileè¯­æ³•
2. ç¡®è®¤.dockerignoreé…ç½®
3. æŸ¥çœ‹Dockeræ„å»ºæ—¥å¿—

#### æµ‹è¯•å¤±è´¥
1. æ£€æŸ¥TestNGæµ‹è¯•é…ç½®
2. ç¡®è®¤æµ‹è¯•ä¾èµ–
3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šè¯¦æƒ…

## ğŸ”„ è‡ªå®šä¹‰é…ç½®

### 1. ä¿®æ”¹è§¦å‘åˆ†æ”¯
```yaml
filters:
  branches:
    only:
      - main
      - develop
      - /feature\/.*/
```

### 2. æ·»åŠ æ›´å¤šæµ‹è¯•
```yaml
- run:
    name: è¿è¡Œé›†æˆæµ‹è¯•
    command: |
      ./gradlew integrationTest --no-daemon
```

### 3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```yaml
- run:
    name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
    command: |
      # éƒ¨ç½²è„šæœ¬
      ./scripts/deploy-production.sh
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. åˆ†æ”¯ç­–ç•¥
- ä½¿ç”¨featureåˆ†æ”¯å¼€å‘æ–°åŠŸèƒ½
- é€šè¿‡PRåˆå¹¶åˆ°mainåˆ†æ”¯
- ä¿æŒmainåˆ†æ”¯çš„ç¨³å®šæ€§

### 2. æäº¤ä¿¡æ¯
- ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
- éµå¾ªçº¦å®šå¼æäº¤è§„èŒƒ

### 3. æµ‹è¯•è¦†ç›–
- ç¡®ä¿æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æœ‰æµ‹è¯•
- ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§
- å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹

## ğŸ†˜ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹CircleCIå®˜æ–¹æ–‡æ¡£
2. æ£€æŸ¥é¡¹ç›®GitHub Issues
3. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºéœ€è¦ä¸‹è½½ä¾èµ–å’Œæ„å»ºDockeré•œåƒã€‚åç»­æ„å»ºä¼šåˆ©ç”¨ç¼“å­˜ï¼Œé€Ÿåº¦ä¼šæ˜¾è‘—æå‡ã€‚
